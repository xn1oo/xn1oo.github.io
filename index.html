<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>XN1OO</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      font-family: monospace;
      color: white;
      background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      overflow: hidden;
    }
    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    #centerText {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: bold;
      transition: all 1s ease;
      text-shadow: 0 0 10px white;
    }
    #playButton {
      position: absolute;
      top: 60%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 23px;
      border-radius: 12px;
      background: #444;
      color: white;
      border: none;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 5px white; }
      50% { box-shadow: 0 0 15px white; }
      100% { box-shadow: 0 0 5px white; }
    }
    #moon {
      position: absolute;
      top: 50px;
      right: 80px;
      width: 80px;
      height: 80px;
      background: url('https://i.ibb.co/zfyzQ5q/pixel-moon.png') no-repeat center/cover;
      display: none;
      cursor: pointer;
    }

    /* Store GUI */
    #storeGUI {
      position: absolute;
      top: 100px;
      left: 100px;
      width: 320px;
      height: auto;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(8px);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.3);
      box-shadow: 0 0 15px rgba(255,255,255,0.3);
      padding: 10px;
      display: none;
      cursor: grab;
    }
    #storeHeader {
      font-size: 20px;
      font-weight: bold;
      text-shadow: 0 0 8px white;
      margin-bottom: 10px;
      animation: pulse 2s infinite;
    }

    .section {
      margin: 10px 0;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 6px;
      overflow: hidden;
    }
    .sectionTitle {
      padding: 8px;
      background: rgba(255,255,255,0.05);
      color: white;
      cursor: pointer;
      font-weight: bold;
      text-shadow: 0 0 8px white;
      transition: background 0.3s;
    }
    .sectionTitle:hover {
      background: rgba(255,255,255,0.1);
    }
    .sectionContent {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
    }
    .sectionContent.open {
      max-height: 500px;
    }
    .storeItem {
      padding: 6px 10px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .storeItem:hover {
      background: rgba(255,255,255,0.1);
    }

    #leaderboard {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 16px;
      white-space: pre;
    }
    #userInfo {
      position: absolute;
      bottom: 40px;
      left: 20px;
      font-size: 16px;
    }
    #timeSpent {
      position: absolute;
      bottom: 20px;
      left: 20px;
      font-size: 16px;
    }
    #typingText {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      white-space: pre;
    }
    .cursor {
      display: inline-block;
      width: 10px;
      background: white;
      margin-left: 2px;
      animation: blink 0.8s infinite;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="centerText">X N 1 O O</div>
  <button id="playButton" style="display:none;">Play</button>
  <div id="moon"></div>

  <!-- Store -->
  <div id="storeGUI">
    <div id="storeHeader">Store</div>
    <div class="section">
      <div class="sectionTitle">Name Effects</div>
      <div class="sectionContent">
        <div class="storeItem">Sparkles</div>
        <div class="storeItem">Flash</div>
        <div class="storeItem">Snow</div>
      </div>
    </div>
    <div class="section">
      <div class="sectionTitle">Name Colors</div>
      <div class="sectionContent">
        <div class="storeItem">Pink</div>
        <div class="storeItem">Red</div>
        <div class="storeItem">Blue</div>
        <div class="storeItem">Orange</div>
        <div class="storeItem">Black</div>
      </div>
    </div>
  </div>

  <div id="typingText"></div>
  <div id="leaderboard">Leaderboard:</div>
  <div id="userInfo"></div>
  <div id="timeSpent">Time: 0 min</div>

  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB4CcE_afYUrjwpp_DCaJwUuow478JRfP8",
      authDomain: "xn1oo-bb64d.firebaseapp.com",
      databaseURL: "https://xn1oo-bb64d-default-rtdb.firebaseio.com",
      projectId: "xn1oo-bb64d",
      storageBucket: "xn1oo-bb64d.firebasestorage.app",
      messagingSenderId: "767448528500",
      appId: "1:767448528500:web:6a39c8c16abb037643c321",
      measurementId: "G-TMZ3FH9WL0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // --- Core elements
    const playButton = document.getElementById("playButton");
    const centerText = document.getElementById("centerText");
    const moon = document.getElementById("moon");
    const storeGUI = document.getElementById("storeGUI");
    const typingText = document.getElementById("typingText");
    const leaderboardDiv = document.getElementById("leaderboard");
    const userInfo = document.getElementById("userInfo");
    const timeSpentDiv = document.getElementById("timeSpent");

    let userName = localStorage.getItem("userName") || null;
    let timeSpent = parseInt(localStorage.getItem("timeSpent")) || 0;

    // Show Play button after 2s
    setTimeout(() => playButton.style.display = "block", 2000);

    playButton.addEventListener("click", () => {
      playButton.style.display = "none";
      centerText.style.top = "20%";
      centerText.style.fontSize = "32px";
      moon.style.display = "block";

      runTypingSequence();
      startTimer();
    });

    // Typing effect
    function typeWriter(text, delay=50) {
      return new Promise(resolve => {
        let i = 0;
        const cursor = document.createElement("span");
        cursor.className = "cursor";
        typingText.appendChild(cursor);

        function type() {
          if (i < text.length) {
            cursor.insertAdjacentText("beforebegin", text.charAt(i));
            i++;
            setTimeout(type, delay);
          } else {
            setTimeout(() => {
              cursor.remove();
              resolve();
            }, 500);
          }
        }
        type();
      });
    }

    async function runTypingSequence() {
      if (!userName) {
        await typeWriter("Welcome, ");
        await new Promise(r => setTimeout(r, 1000));
        await typeWriter("to my Website.");
        typingText.innerHTML += "\\n";
        await typeWriter("I Created this while I was sick at home, ");
        await new Promise(r => setTimeout(r, 1000));
        await typeWriter("and also because I was bored.");
        typingText.innerHTML += "\\n";
        await typeWriter("But anyways just sit here and just do whatever.");
        typingText.innerHTML += "\\n";
        await typeWriter("What's your name? (click to edit)");

        const nameSpan = document.createElement("span");
        nameSpan.contentEditable = true;
        nameSpan.style.borderBottom = "1px dashed white";
        nameSpan.style.marginLeft = "5px";
        typingText.appendChild(nameSpan);

        nameSpan.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            userName = nameSpan.innerText.trim();
            localStorage.setItem("userName", userName);
            typingText.innerHTML = "";
            greetUser();
          }
        });
      } else {
        greetUser();
      }
    }

    async function greetUser() {
      await typeWriter("Hello, " + userName);
      setTimeout(() => typingText.innerHTML = "", 1000);
    }

    // Timer
    function startTimer() {
      updateTimeDisplay();
      setInterval(() => {
        timeSpent++;
        localStorage.setItem("timeSpent", timeSpent);
        updateTimeDisplay();
        updateFirebase();
      }, 60000);
    }
    function updateTimeDisplay() {
      timeSpentDiv.textContent = "Time: " + timeSpent + " min";
      userInfo.textContent = "Your name: " + (userName || "(not set)");
    }

    // Firebase update
    function updateFirebase() {
      if (userName) {
        set(ref(db, "users/" + userName), { timeSpent });
      }
    }
    onValue(ref(db, "users"), (snapshot) => {
      const data = snapshot.val();
      if (data) {
        const sorted = Object.entries(data)
          .sort((a,b) => b[1].timeSpent - a[1].timeSpent);
        leaderboardDiv.textContent = "Leaderboard:\\n" + 
          sorted.map((e,i)=>`${i+1}. ${e[0]}: ${e[1].timeSpent} min`).join("\\n");
      }
    });

    // Store GUI toggle
    moon.addEventListener("click", () => {
      storeGUI.style.display = storeGUI.style.display === "block" ? "none" : "block";
    });

    // Store section toggle
    document.querySelectorAll('.sectionTitle').forEach(title => {
      title.addEventListener('click', () => {
        const content = title.nextElementSibling;
        content.classList.toggle('open');
      });
    });

    // Make store draggable
    storeGUI.addEventListener("mousedown", function(e) {
      let shiftX = e.clientX - storeGUI.getBoundingClientRect().left;
      let shiftY = e.clientY - storeGUI.getBoundingClientRect().top;
      function moveAt(pageX, pageY) {
        storeGUI.style.left = pageX - shiftX + "px";
        storeGUI.style.top = pageY - shiftY + "px";
      }
      function onMouseMove(e) {
        moveAt(e.pageX, e.pageY);
      }
      document.addEventListener("mousemove", onMouseMove);
      document.addEventListener("mouseup", () => {
        document.removeEventListener("mousemove", onMouseMove);
      }, { once: true });
    });
  </script>
</body>
</html>
